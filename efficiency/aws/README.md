# استخدام برامج الأوامر bash لإدارة إعدادات دورة حياة بيئات العمل على SageMaker Domains لتعزيز كفاءة التطوير

تتيح لك برامج إعدادت دورة الحياة - Lifecyle configurations scripts - في SageMaker Domains وNotebooks أتمتة مهام مختلفة تُساهم في تحسين كفاءة بيئات العمل وإعلاء إنتاجية فريق عمل التعلُّم الآلي. يتمّ تشغيل هذه النصوص آليًّا كجزء من دورة حياة بيئة العمل، مثل إنشاء أو بدء تشغيل خادم دفتر JupterLab. باستخدام هذه البرامج، يمكنك تحقيق الفوائد التالية:

1. **تحسين التكلفة**: يُمكنك باستخدام هذه البرامج تفعيل الإعدادت اللازمة لإغلاق خوادم دفاتر JupterLab المُستخدمة من فريق التطوير التي تتجاوز مُدة خمولها - idle time – مُدّة مُعيّنة مثلا 3600 ثانية تلقائيا لتقليل التكاليف المرتبطة بتشغيل الموارد أثناء التطوير. 
2. **زيادة الإنتاجية**: يُمكنك تثبيت Docker على خوادم JupterLab ممّا يُمكنّ قريق التطوير من استخدام الوضع المحلي للتشغيل والذي يُمكنّ من تصحيح أخطاء الكود واختباره بشكل أسرع. من خلال تشغيل Docker في الوضع المحلي، يمكنك تقليل الوقت المطلوب لتكرارات تصحيح الأخطاء والاختبار بشكل كبير، مما يسمح بدورات تطوير أكثر كفاءة وأوقات استجابة أسرع.
3. **البيئات المتسقة**: قم بتحميل التبعيات أو الحزم أو مجموعات البيانات المطلوبة لتدفقات عمل التعلم الآلي الخاصة بك مسبقًا. وهذا يضمن بيئة متسقة عبر حالات دفتر الملاحظات المختلفة، مما يقلل من وقت الإعداد ويقلل من احتمالية حدوث أخطاء أو تناقضات.
4. **الإعداد التلقائي**: قم بأتمتة تثبيت وتكوين الأدوات أو المكتبات أو الأطر المطلوبة لحالات الاستخدام المحددة لديك. وهذا يبسط عملية الإعداد ويقلل من الجهد اليدوي المطلوب، مما يسمح لك بالتركيز على مهام التعلم الآلي الأساسية لديك.
5. **التخصيص**: قم بتخصيص بيئة دفتر الملاحظات وفقًا لاحتياجاتك المحددة من خلال تنفيذ البرامج النصية أو الأوامر المخصصة أثناء أحداث دورة الحياة. تمكنك هذه المرونة من تكييف البيئة مع متطلباتك الفريدة، مما يعزز الإنتاجية والكفاءة.

## برامج إعدادت إدارة دورة الحياة - Lifecycle Configuration

هذه البرامج هي نصوص bash عادية يتم تشغيلها في كل مرة يتم فيها بدء تشغيل بيئة العمل من نوع JupterLab التي ترتبط بها.
وبالتالي، يمكن استخدامها لتثبيت التبعيات - dependencies، واستنساخ مستودعات git، وتكوين البيئة، وما إلى ذلك.
بمجرد تشغيلها بنجاح، ستكون البيئة جاهزة للمستخدم كُلّ الإعدادت المُدرجة داخل هذه النصوص.

يقوم النص `jupyterlab-setup-lcc-script.sh` بتثبيت الإعداد اللاّزمة لأداء المهمّات التّالية:

1. الإغلاق التلقائي للخوادم التي يستخدمها SageMaker Jupyterlab إذا كانت خاملة لأكثر من 3600 ثانية.
2. كما يقوم بتثبيت تبعيات Docker للسماح لك باستخدام [وضع SageMaker Local](https://docs.aws.amazon.com/sagemaker/latest/dg/pipelines-local-mode.html) عند تطوير وظائف ML.

## تثبيت برنامج إدارة إعدادت دورة الحياة – LCC
يُمكنك تثبيت برنامج الLCC المُدرج في هذا المُجلد بخطوة واحدة كما في الخيار الأول أو خطوة بخطوة كما في الخيار الثاني. 
### الخيار 1: التثبيت باستخدام `install-lcc-script.sh`

يمكنك تثبيت برنامج الLCC المُسمى  `jupyterlab-setup-lcc-script.sh` آليًّا باستخدام برنامج التثبيت المُدرج في هذا المثال والمُسمى `install-lcc-script.sh` عن طريق تحميل البرنامجين النصيين إلى AWS CloudShell أو Cloud9 وتشغيل الأمر التالي.

```
install-lcc-script.sh <domain_id> <lifecycle_config_name>
````

### الخيار 2: تثبيت برنامج الLCC خطوة بخطوة

لتثبيت البرنامج النصي  لأوامر إدارة إعدادات دورة الحياة خطوة بخطوة أو فهم الخطوات المطلوبة لتثبيته، اتبع التعليمات أدناه:

1. حدد معرف نطاق SageMaker الذي تريد تنشيط Docker فيه. يمكنك القيام بذلك من خلال وحدة تحكم SageMaker
1. انتقل إلى [وحدة تحكم SageMaker](https://console.aws.amazon.com/sagemaker/home)، وتأكد من أنك في المنطقة الصحيحة.
2. انقر فوق **المجالات** في لوحة التنقل اليسرى. سترى قائمة بالمجالات، انسخ معرف المجال ذي الصلة.
2. استبدل `<DOMAIN_ID>` في الأمر التالي بمعرف المجال الخاص بك، ثم قم بتشغيله باستخدام AWS CloudShell لتمكين docker على المجال ذي الصلة
```
DOMAIN_ID="<DOMAIN_ID>"
aws --region $AWS_REGION sagemaker update-domain --domain-id $DOMAIN_ID \
--domain-settings-for-update '{"DockerSettings": {"EnableDockerAccess": "ENABLED"}}'
```
بعد ذلك، نتبع الخطوات المذكورة في [الوثائق الرسمية](https://docs.aws.amazon.com/sagemaker/latest/dg/jl-lcc-create.html) لإنشاء البرنامج وربطه داخل `jupyterlab-setup-lcc-script.sh`
بالمجال الذي تختاره. الخطوات موضحة أدناه:

1. قم بتحميل البرنامج النصي `jupyterlab-setup-lcc-script.sh` إلى AWS CloudShell.
2. قم بتشغيل الأمر أدناه لتخزين إصدار `base64` من البرنامج النصي في متغير البيئة LCC_CONTENT
```
LCC_CONTENT=`openssl base64 -A -in jupyterlab-setup-lcc-script.sh`
```
3. بعد ذلك، قم بتشغيل الأمر التالي لإنشاء تكوين دورة حياة يتم تشغيله عند تشغيل تطبيق JupyterLab المرتبط. سيتم إنشاء البرنامج النصي باسم `setup-jupyterlab-environment`.
```
aws sagemaker create-studio-lifecycle-config \
--region $AWS_REGION \
--studio-lifecycle-config-name setup-jupyterlab-environment \
--studio-lifecycle-config-content $LCC_CONTENT \
--studio-lifecycle-config-app-type JupyterLab
```
4. أخيرًا، قم بإرفاق البرنامج النصي لتكوين دورة الحياة بنطاقك، عن طريق تحديث `<DOMAIN_ID>`  في الأوامر التالية، ثم تشغيلها عبر AWS CloudShell.
```
AWS_ACCOUNT_ID=`aws sts get-caller-identity --query Account --output text`
LCC_ARN="arn:aws:sagemaker:$AWS_REGION:$AWS_ACCOUNT_ID:studio-lifecycle-config/setup-jupyterlab-environment"
aws sagemaker update-domain \
--domain-id $DOMAIN_ID \
--region $AWS_REGION \
--default-user-settings "{
\"JupyterLabAppSettings\": {
\"LifecycleConfigArns\":
[\"$LCC_ARN\"]
}
}"
```